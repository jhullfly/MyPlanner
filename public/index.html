<!doctype html>
<head>
  <meta charset="utf-8">

  <title>My Parse App</title>
  <meta name="description" content="My Planner">
  <meta name="viewport" content="width=device-width">
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.3.0.min.js"></script>
</head>

<body>
  
  <div id="main">
      <a href="#" onclick="login()">Login with Facebook</a>
  </div>

  <script type="text/javascript">
      Parse.initialize("4GrpOttZYHYF3ibdfPy8sBpM6AicBW2HpsvygDJZ", "bKgObet82XgL86hRav0AIgMKlGlVzr4wzkR5vJ7j");
  </script>
  <div id="fb-root"></div>
  <script>
      window.fbAsyncInit = function() {
          Parse.FacebookUtils.init({
              appId      : '718417411528182',
              channelUrl : '//myplanner.parseapp.com/channel.html', // Channel File
              cookie     : true, // enable cookies to allow Parse to access the session
              xfbml      : true
          });
      };

      (function(d, s, id){
          var js, fjs = d.getElementsByTagName(s)[0];
          if (d.getElementById(id)) {return;}
          js = d.createElement(s); js.id = id;
          js.src = "//connect.facebook.net/en_US/all.js";
          fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));

      function login() {
          Parse.FacebookUtils.logIn('user_about_me,user_actions.books,user_actions.music,user_actions.news,user_actions.video,user_activities,'+
                  'user_birthday,user_education_history,user_events,user_friends,user_games_activity,user_groups,user_hometown,'+
                  'user_interests,user_likes,user_location,user_photos,user_relationship_details,user_relationships,user_religion_politics,'+
                  'user_status,user_tagged_places,user_videos,user_website,user_work_history,email,manage_notifications,manage_pages,publish_actions,'+
                  'read_friendlists,read_insights,read_mailbox,read_page_mailboxes,read_stream,rsvp_event', {
              success: function(user) {
                  console.log("User logged in through Facebook! " + JSON.stringify(user.get("authData")));
                  Parse.Cloud.run("CallBackgroundJob", {
                      jobName : 'PhotoAnalyzer',
                      userId : user.id
                  }).then(function() {window.location = 'data.html';});
              },
              error: function(user, error) {
                  alert("User cancelled the Facebook login or did not fully authorize.");
              }
          });
      }

  </script>
</body>

</html>
